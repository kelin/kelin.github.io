<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="Kelin"><title>矩阵的应用 | Kelin's blog</title><link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Source+Code+Pro"><link rel="stylesheet" type="text/css" href="/css/style.css?v=1.0.0"><link rel="stylesheet" type="text/css" href="/css/highlight.css?v=1.0.0"><link rel="Shortcut Icon" href="/favicon.ico"><link rel="bookmark" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">矩阵的应用</h1><a id="logo" href="/.">Kelin's blog</a><p class="description">Kelin's blog</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div id="layout" class="layout-g"><div class="layout-l"><div class="content_container"><div class="post"><h1 class="post-title">矩阵的应用</h1><div class="post-meta">Nov 21, 2016<span> | </span><span class="category"><a href="/categories/OpenGL-ES/">OpenGL ES</a></span><script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> Hits</span></span></div><div class="post-content"><h1 id="模型矩阵"><a href="#模型矩阵" class="headerlink" title="模型矩阵"></a>模型矩阵</h1><p>模型矩阵是相对于世界坐标系的，包含一系列平移、缩放、旋转的变换信息的矩阵。它与点的位置没有任何关系。基本的模型矩阵有平移矩阵、缩放矩阵、旋转矩阵，模型矩阵左乘模型矩阵，还是模型矩阵。点坐标左乘模型矩阵就能得到最终变换的坐标。因此，多个顶点能共用同一个模型矩阵，一般一个模型里的所有顶点都共用一个模型矩阵。</p>
<h2 id="平移矩阵"><a href="#平移矩阵" class="headerlink" title="平移矩阵"></a>平移矩阵</h2><p>$$<br> \left[<br> \begin{matrix}<br>   1 &amp; 0 &amp; 0 &amp; X_t \\<br>   0 &amp; 1 &amp; 0 &amp; Y_t \\<br>   0 &amp; 0 &amp; 1 &amp; Z_t \\<br>   0 &amp; 0 &amp; 0 &amp; 1<br>  \end{matrix}<br>  \right]<br>$$<br>例如：Vec(2,2,0) 沿着X轴平移3，沿着Y轴平移3，则：<br>$$<br>\left[<br>    \begin{matrix}<br>        1 &amp; 0 &amp; 0 &amp; 3 \\<br>        0 &amp; 1 &amp; 0 &amp; 3 \\<br>        0 &amp; 0 &amp; 1 &amp; 0 \\<br>        0 &amp; 0 &amp; 0 &amp; 1<br>    \end{matrix}<br>\right]<br>\left[<br>    \begin{matrix}<br>        2 \\<br>        2 \\<br>        0 \\<br>        1<br>    \end{matrix}<br>\right]<br>=<br>\left[<br>    \begin{matrix}<br>        5 \\<br>        5 \\<br>        0 \\<br>        1<br>    \end{matrix}<br>\right]<br>$$</p>
<h2 id="缩放矩阵"><a href="#缩放矩阵" class="headerlink" title="缩放矩阵"></a>缩放矩阵</h2><p>$$<br>\begin{bmatrix}<br>    S_x &amp; 0 &amp; 0 &amp; 0 \\<br>    0 &amp; S_y &amp; 0 &amp; 0 \\<br>    0 &amp; 0 &amp; S_z &amp; 0 \\<br>    0 &amp; 0 &amp; 0 &amp; 1<br>\end{bmatrix}<br>$$</p>
<h2 id="旋转矩阵"><a href="#旋转矩阵" class="headerlink" title="旋转矩阵"></a>旋转矩阵</h2><p>点绕z轴旋转：<br>$$<br>\begin{bmatrix}<br>    \cos\theta &amp; -\sin\theta &amp; 0 &amp; 0 \\<br>    \sin\theta &amp; \cos\theta &amp; 0 &amp; 0 \\<br>    0 &amp; 0 &amp; 1 &amp; 0 \\<br>    0 &amp; 0 &amp; 0 &amp; 1<br>\end{bmatrix}<br>$$</p>
<p>点绕x轴旋转：<br>$$\begin{bmatrix}<br>    1 &amp; 0 &amp; 0 &amp; 0 \\<br>    0 &amp; \cos\theta &amp; -\sin\theta &amp; 0 \\<br>    0 &amp; \sin\theta &amp; \cos\theta &amp; 0 \\<br>    0 &amp; 0 &amp; 0 &amp; 1<br>\end{bmatrix}$$</p>
<p>点绕y轴旋转：<br>$$\begin{bmatrix}<br>    \cos\theta &amp; 0 &amp; -\sin\theta &amp; 0\\<br>    0 &amp; 1 &amp; 0 &amp; 0\\<br>    \sin\theta &amp; 0 &amp; \cos\theta &amp; 0 \\<br>    0 &amp; 0 &amp; 0 &amp; 1<br>\end{bmatrix}$$</p>
<hr>
<h1 id="视图矩阵"><a href="#视图矩阵" class="headerlink" title="视图矩阵"></a>视图矩阵</h1><p>概念：视图矩阵是本地坐标系在世界坐标系中的变换的模型矩阵的逆矩阵，因此视图矩阵也是可以分为平移、缩放、旋转的。<br>好吧，说点人话，一个摄像机，在世界坐标系中，经过模型矩阵<em>M1</em>（模型变换），从原点沿着X轴正方向前进10单位。这时候，摄像机的视图矩阵为<em>M2</em>，而且<em>M2</em>是<em>M1</em>的逆矩阵。<em>M2</em>的几何含义：假设摄像机一直原地不动，而是这个世界以<em>M2</em>为模型矩阵进行变换，往后移动了10个单位，也就是摄像机在世界坐标系下的平移、缩放、旋转等变换的反向过程。<br>作用：获得相对坐标（本地坐标）。<br>将视图矩阵左乘一个物体最终的模型矩阵，得到的矩阵就是所谓的“模型视图矩阵”。“模型视图矩阵”左乘一个世界坐标系下的坐标点，得到的是相对于本地坐标系的坐标点。<br>举个例子：一个摄像机和一个物体，一起同样的速度和方向，从世界坐标系的原点沿着X轴的正方形移动了10个单位。摄像机的视图矩阵左乘物体的模型矩阵（模型视图矩阵）表示的含义可以理解为：世界往X轴的负方向移动了10个单位，然后在沿x轴正方向移动10个单位，因此任何一个坐标点乘以这个模型视图矩阵，都不会发生变化，明显，摄像机和物体相对静止的。</p>
<hr>
<h1 id="投影矩阵"><a href="#投影矩阵" class="headerlink" title="投影矩阵"></a>投影矩阵</h1><p>投影矩阵就是把三维空间投影到二维的空间。方式有正交和透视两种。</p>
<h2 id="正交投影矩阵"><a href="#正交投影矩阵" class="headerlink" title="正交投影矩阵"></a>正交投影矩阵</h2><ul>
<li>作用：正交投影矩阵可以把虚拟坐标转换回归一化设备坐标（正交投影矩阵乘以虚拟坐标）。</li>
<li>归一化设备坐标：在OpenGL里，一切物体都要映射到X、Y轴和Z轴的[-1,1]范围内，这个范围内的坐标被称为归一化设备坐标，其独立于屏幕实际的尺寸。归一化设备坐标假定坐标空间是个正方形。</li>
<li>虚拟坐标空间：为了让屏幕形状考虑进来，把宽和高中较小的一个的范围定在[-1,1]内，另外一个根据屏幕尺寸比例调整为较大的范围。</li>
</ul>
<p>正交投影矩阵如下：<br>$$<br> \left[<br> \begin{matrix}<br>   \frac{2}{right-left} &amp; 0 &amp; 0 &amp; -\frac{right+left}{right-left} \\<br>   0 &amp; \frac{2}{top-bottom} &amp; 0 &amp; -\frac{top+bottom}{top-bottom} \\<br>   0 &amp; 0 &amp;  -\frac{2}{far-near} &amp; -\frac{far+near}{far-near} \\<br>   0 &amp; 0 &amp; 0 &amp; 1<br>  \end{matrix}<br>  \right]<br>$$<br>注意：使用的是左手坐标系还是右手坐标系，这两者的Z轴是相反的。<br>其实在一个顶点着色器的顶点位置(gl_Position)变为归一化设备坐标前，还会做透视除法（xyz都除以w）。</p>
<h2 id="透视投影矩阵"><a href="#透视投影矩阵" class="headerlink" title="透视投影矩阵"></a>透视投影矩阵</h2><p>透视投影矩阵最大的作用是产生正确的w值。w值可以理解为距离，w值越大，离中心点越近。</p>
<p>透视投影矩阵<br>$$<br> \left[<br> \begin{matrix}<br>   \frac{α}{width/height} &amp; 0 &amp; 0 &amp; 0 \\<br>   0 &amp; α &amp; 0 &amp; 0 \\<br>   0 &amp; 0 &amp; -\frac{far+near}{far-near} &amp; -\frac{2*far*near}{far-near} \\<br>   0 &amp; 0 &amp; -1 &amp; 0<br>  \end{matrix}<br>  \right]<br>$$<br>其中α是焦距:<br>$$α = \frac {1} {tan(FOV/2)}$$<br>FOV是相机的垂直视角，而不是水平视角<br>width:屏幕宽度<br>height:屏幕高度<br>far: 到远处平面的距离（&gt;0 &amp;&amp; &gt; near）<br>near: 到近处平面的距离（&gt;0）</p>
<hr>
<h1 id="虚拟世界的顶点画到在屏幕上经过的变换过程"><a href="#虚拟世界的顶点画到在屏幕上经过的变换过程" class="headerlink" title="虚拟世界的顶点画到在屏幕上经过的变换过程"></a>虚拟世界的顶点画到在屏幕上经过的变换过程</h1><p>变换后的坐标 = 视口矩阵 x 投影矩阵 x 视图矩阵 x 模型矩阵 x 模型点坐标</p>
</div><div class="tags"><a href="/tags/OpenGL-ES/">OpenGL ES</a></div></div></div></div><div class="layout-r"><div id="sidebar"><div class="widget"><div id="search-form"><div id="result-mask" class="hide"></div><label><input id="search-key" type="text" autocomplete="off" placeholder="请输入关键字..."/></label><div id="result-wrap" class="hide"><div id="search-result"></div></div><div class="hide"><template id="search-tpl"><div class="item"><a href="/{path}" title="{title}"><div class="title">{title}</div><div class="time">{date}</div><div class="tags">{tags}</div></a></div></template></div></div></div><div class="widget"><div class="widget-title"><i class="fa fa-gui"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/OpenGL-ES/">OpenGL ES</a><span class="category-list-count">1</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-biao"> 标签</i></div><div class="tagcloud"><a href="/tags/OpenGL-ES/" style="font-size: 15px;">OpenGL ES</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-fei"> 归档</i></div><ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/11/">十一月 2016</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-xie"> 最新文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2016/11/21/OpenGLES-matrix-usage/">矩阵的应用</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-you"> 友情链接</i></div></div></div></div></div><a id="totop" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=1.0.0" async></script><div id="footer"><div class="footer-info"><p><span>联系博主：<a href="mailto:chenkelinsky@163.com" target="_blank" class="fa fa-email"> </a><a href="https://github.com/kelin" target="_blank" class="fa fa-github"> </a></span></p><p><span> Copyright &copy;<a href="/." rel="nofollow">Kelin Chen</a></span><span> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a></span><span><a rel="nofollow" target="_blank" href="https://github.com/chaooo/hexo-theme-BlueLake"> Theme </a>by<a rel="nofollow" target="_blank" href="https://github.com/chaooo"> Charles.</a></span></p></div></div></div><script type="text/javascript" src="/js/search.json.js?v=1.0.0"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({
  tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}
  });
</script><script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML" async></script></body></html>